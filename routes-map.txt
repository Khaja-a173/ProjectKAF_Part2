Phase 4 - Live Order Lifecycle & Payments Routes Map

=== PUBLIC ROUTES ===
GET  /qr/:tenantCode/:tableNumber          - QR code entry (public)
GET  /menu/public?tenantCode=XYZ           - Public menu access

=== CART & CHECKOUT ROUTES (ENABLE_CART_CHECKOUT) ===
POST /cart                                 - Create cart
GET  /cart/:id                            - Get cart details
POST /checkout/create-intent              - Create payment intent
POST /checkout/confirm                    - Confirm payment
POST /checkout/cancel                     - Cancel payment

=== ORDER MANAGEMENT ROUTES (AUTH REQUIRED) ===
GET  /orders                              - List orders (existing)
POST /orders/:id/emit-status              - Emit order status change
GET  /kds/lanes                          - KDS lanes view (ENABLE_KDS_RT)
POST /kds/orders/:id/advance             - Advance order status (ENABLE_KDS_RT)

=== PAYMENT ROUTES (AUTH REQUIRED) ===
GET  /payments/config                     - Get payment config (existing)
PUT  /payments/config                     - Update payment config (existing)
POST /payments/intent                     - Create payment intent (existing)
POST /payments/capture                    - Capture payment (existing)
POST /payments/refund                     - Refund payment (existing)
POST /payments/split                      - Split payment (existing)

GET  /payments/providers                  - List payment providers
POST /payments/providers                  - Create payment provider
PATCH /payments/providers/:id             - Update payment provider
POST /payments/providers/:id/make-default - Set default provider
POST /payments/intents/:id/emit-event     - Emit payment event
POST /payments/webhook/:provider          - Payment webhook (existing)

=== EXISTING ROUTES (UNCHANGED) ===
GET  /_health                            - Health check
GET  /auth/whoami                        - User info
POST /auth/login                         - Login
GET  /tenants                           - List tenants
POST /tenants                           - Create tenant
GET  /analytics/summary                  - Analytics summary
GET  /analytics/revenue                  - Revenue data

=== FRONTEND ROUTES ===
/                                        - Dashboard
/login                                   - Login page
/admin/tenants                          - Tenant management
/admin/payments                         - Payment settings

/qr/:tenantCode/:tableNumber            - QR entry (VITE_ENABLE_QR_FLOW)
/menu/:tenantCode                       - Public menu (VITE_ENABLE_QR_FLOW)
/cart/:cartId                           - Cart page (VITE_ENABLE_CART_CHECKOUT)
/checkout/:intentId                     - Checkout page (VITE_ENABLE_PAYMENTS)
/checkout                               - Checkout page (existing)
/checkout/success                       - Success page
/order/:orderId                         - Order tracking
/kds                                    - Kitchen Display (VITE_ENABLE_KDS_RT)

=== FEATURE FLAG CONTROLS ===
ENABLE_QR_FLOW=true                     - QR and menu endpoints
ENABLE_CART_CHECKOUT=true               - Cart and checkout endpoints
ENABLE_KDS_RT=true                      - KDS realtime endpoints
ENABLE_PAYMENTS=true                    - Extended payment endpoints

VITE_ENABLE_QR_FLOW=true               - QR and menu UI
VITE_ENABLE_CART_CHECKOUT=true         - Cart and checkout UI
VITE_ENABLE_KDS_RT=true                - KDS UI
VITE_ENABLE_PAYMENTS=true              - Payment UI

=== AUTHENTICATION ===
Public: /qr/*, /menu/public, /_health
Authenticated: All other routes require Bearer token
Tenant Scoped: All data operations filtered by req.auth.primaryTenantId

=== DATABASE TABLES ===
New Tables:
- carts, cart_items
- order_status_events
- payment_providers, payment_intents, payment_events
- payment_refunds, payment_splits

New Views:
- v_orders_latest_status
- v_kds_lane_counts

New Functions:
- app.mark_payment_intent_status()